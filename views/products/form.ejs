<div class="container mt-4">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">
                <i class="fas fa-<%= isEdit ? 'edit' : 'plus' %> me-2"></i>
                <%= isEdit ? 'Sửa sản phẩm' : 'Thêm sản phẩm' %>
            </h1>
            <p class="text-muted mb-0">
                <%= isEdit ? 'Cập nhật thông tin sản phẩm' : 'Thêm sản phẩm mới vào hệ thống' %>
            </p>
        </div>
        <a href="/products/admin" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>
            Quay lại
        </a>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-body">
                    <form action="/products<%= isEdit ? '/' + product._id : '' %>" 
                          method="POST">
                        <% if (isEdit) { %>
                            <input type="hidden" name="_method" value="PUT">
                        <% } %>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="name" class="form-label">Tên sản phẩm *</label>
                                    <input type="text" class="form-control" id="name" name="name" 
                                           value="<%= locals.formData ? locals.formData.name || '' : 
                                                     (isEdit ? product.name : '') %>" 
                                           maxlength="100" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="sku" class="form-label">SKU</label>
                                    <input type="text" class="form-control" id="sku" name="sku" 
                                           value="<%= locals.formData ? locals.formData.sku || '' : 
                                                     (isEdit ? product.sku || '' : '') %>" 
                                           maxlength="50">
                                    <small class="form-text text-muted">Mã sản phẩm (tùy chọn)</small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="price" class="form-label">Giá (VNĐ) *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="price" name="price" 
                                               value="<%= locals.formData ? locals.formData.price || '' : 
                                                         (isEdit ? product.price : '') %>" 
                                               min="0" step="1000" required>
                                        <span class="input-group-text">đ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="quantity" class="form-label">Số lượng *</label>
                                    <input type="number" class="form-control" id="quantity" name="quantity" 
                                           value="<%= locals.formData ? locals.formData.quantity || '' : 
                                                     (isEdit ? product.quantity : '') %>" 
                                           min="0" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="supplier" class="form-label">Nhà cung cấp *</label>
                                    <select class="form-select" id="supplier" name="supplier" required>
                                        <option value="">Chọn nhà cung cấp</option>
                                        <% suppliers.forEach(function(supplier) { %>
                                            <option value="<%= supplier._id %>" 
                                                    <%= (locals.formData && locals.formData.supplier === supplier._id.toString()) ||
                                                        (isEdit && product.supplier._id.toString() === supplier._id.toString()) ? 'selected' : '' %>>
                                                <%= supplier.name %>
                                            </option>
                                        <% }); %>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="category" class="form-label">Danh mục</label>
                                    <input type="text" class="form-control" id="category" name="category" 
                                           value="<%= locals.formData ? locals.formData.category || '' : 
                                                     (isEdit ? product.category || '' : '') %>" 
                                           maxlength="50" placeholder="Ví dụ: Điện tử, Gia dụng...">
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="description" class="form-label">Mô tả</label>
                            <textarea class="form-control" id="description" name="description" 
                                      rows="4" maxlength="500" 
                                      placeholder="Mô tả chi tiết về sản phẩm..."><%= locals.formData ? locals.formData.description || '' : 
                                                                                      (isEdit ? product.description || '' : '') %></textarea>
                            <small class="form-text text-muted">Tối đa 500 ký tự</small>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-<%= isEdit ? 'primary' : 'success' %>">
                                <i class="fas fa-<%= isEdit ? 'save' : 'plus' %> me-2"></i>
                                <%= isEdit ? 'Cập nhật' : 'Thêm mới' %>
                            </button>
                            <a href="/products/admin" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-2"></i>
                                Hủy
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Format price input
    const priceInput = document.getElementById('price');
    priceInput.addEventListener('input', function() {
        let value = this.value.replace(/[^\d]/g, '');
        if (value) {
            this.value = parseInt(value);
        }
    });

    // Auto-generate SKU if empty
    const nameInput = document.getElementById('name');
    const skuInput = document.getElementById('sku');
    
    nameInput.addEventListener('blur', function() {
        if (!skuInput.value && this.value) {
            const sku = this.value
                .toUpperCase()
                .replace(/[^A-Z0-9]/g, '')
                .substring(0, 10) + '-' + Date.now().toString().slice(-4);
            skuInput.value = sku;
        }
    });
});
</script>